<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Study Coach</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar for output box */
        #output-box::-webkit-scrollbar { width: 8px; }
        #output-box::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        #output-box::-webkit-scrollbar-track { background: #f1f5f9; }

        /* Custom toggle switch style */
        .toggle-switch {
            width: 48px;
            height: 24px;
            background-color: #e5e7eb;
            border-radius: 9999px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .toggle-switch.checked {
            background-color: #3b82f6; /* Blue-500 */
        }
        .toggle-switch-handle {
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
        }
        .toggle-switch.checked .toggle-switch-handle {
            transform: translateX(24px);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-start justify-center p-6">
    <div class="w-full max-w-4xl bg-white shadow-xl rounded-xl p-8 space-y-8">
        <header class="text-center space-y-2">
            <h1 class="text-4xl font-extrabold text-blue-600">ðŸ“š AI Study Coach</h1>
            <p class="text-gray-500">Generate structured notes from text or image uploads.</p>
        </header>

        <!-- Main Input Section -->
        <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
            <form id="main-form" class="space-y-4">
                <div class="flex flex-col md:flex-row md:items-center justify-between space-y-4 md:space-y-0 md:space-x-6">

                    <div id="text-input-container" class="flex-grow">
                        <label for="main-input" class="sr-only">Query/Text Input</label>
                        <textarea id="main-input" rows="5" class="w-full resize-none p-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-150 shadow-md" placeholder="Enter text or a topic (e.g., 'Explain the stages of mitosis')"></textarea>
                    </div>

                    <!-- Upload Toggle and File Input -->
                    <div class="flex-shrink-0 flex flex-col items-center space-y-2">
                        <div class="flex items-center space-x-3">
                            <span class="text-sm font-medium text-gray-700">Text Mode</span>
                            <div id="upload-toggle" class="toggle-switch">
                                <div class="toggle-switch-handle"></div>
                            </div>
                            <span class="text-sm font-medium text-blue-600">Image Upload</span>
                        </div>
                        
                        <div id="file-upload-container" class="w-full hidden flex-grow">
                            <input type="file" id="file-input" name="file" accept="image/*" class="w-full text-sm text-gray-500 file:mr-4 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" />
                        </div>
                    </div>
                </div>

                <div class="flex justify-between items-center pt-2">
                    <input type="text" id="user-id" class="w-1/4 p-2 text-sm border border-gray-300 rounded-lg" placeholder="User ID (demo-user)" value="demo-user">
                    <button type="submit" id="submit-button" class="px-6 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-300 transition duration-150 disabled:opacity-50">
                        Generate Notes
                    </button>
                </div>
            </form>
        </div>

        <!-- Status & Output Section -->
        <div class="space-y-4">
            <div id="status-message" class="p-3 text-center rounded-lg font-medium bg-blue-100 text-blue-700">
                Ready to generate notes.
            </div>
            
            <div class="bg-white border border-gray-200 rounded-lg shadow-lg">
                <div class="p-4 border-b bg-gray-50">
                    <h3 class="text-xl font-semibold text-gray-700">Output Notes</h3>
                </div>
                <div id="output-box" class="p-6 h-96 overflow-y-auto text-gray-800">
                    <!-- Notes will be rendered here -->
                    <p class="text-gray-400 italic">Submit a query or upload an image to start the analysis...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
Â  Â  Â  Â  const API_BASE_URL = 'http://127.0.0.1:8000'; // Update as necessary
Â  Â  Â  Â  const mainForm = document.getElementById('main-form');
Â  Â  Â  Â  const mainInput = document.getElementById('main-input');
Â  Â  Â  Â  const fileInput = document.getElementById('file-input');
Â  Â  Â  Â  const textInputContainer = document.getElementById('text-input-container');
Â  Â  Â  Â  const fileContainer = document.getElementById('file-upload-container');
Â  Â  Â  Â  const toggleSwitch = document.getElementById('upload-toggle');
Â  Â  Â  Â  const outputBox = document.getElementById('output-box');
Â  Â  Â  Â  const statusEl = document.getElementById('status-message');
Â  Â  Â  Â  const submitButton = document.getElementById('submit-button');
Â  Â  Â  Â  const userIdInput = document.getElementById('user-id');
Â  Â  Â  Â  let isImageMode = false;

Â  Â  Â  Â  // --- Utility Functions ---

Â  Â  Â  Â  function updateStatus(message, type = 'info') {
Â  Â  Â  Â  Â  Â  statusEl.textContent = message;
Â  Â  Â  Â  Â  Â  statusEl.className = 'p-3 text-center rounded-lg font-medium';
Â  Â  Â  Â  Â  Â  if (type === 'info') {
Â  Â  Â  Â  Â  Â  Â  Â  statusEl.classList.add('bg-blue-100', 'text-blue-700');
Â  Â  Â  Â  Â  Â  } else if (type === 'success') {
Â  Â  Â  Â  Â  Â  Â  Â  statusEl.classList.add('bg-green-100', 'text-green-700');
Â  Â  Â  Â  Â  Â  } else if (type === 'error') {
Â  Â  Â  Â  Â  Â  Â  Â  statusEl.classList.add('bg-red-100', 'text-red-700');
Â  Â  Â  Â  Â  Â  } else if (type === 'loading') {
Â  Â  Â  Â  Â  Â  Â  Â  statusEl.classList.add('bg-yellow-100', 'text-yellow-700');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function toggleLoading(state) {
Â  Â  Â  Â  Â  Â  submitButton.disabled = state;
Â  Â  Â  Â  Â  Â  submitButton.textContent = state ? (isImageMode ? 'Processing Image...' : 'Generating Notes...') : 'Generate Notes';
Â  Â  Â  Â  Â  Â  mainInput.disabled = state;
Â  Â  Â  Â  Â  Â  fileInput.disabled = state;
Â  Â  Â  Â  Â  Â  userIdInput.disabled = state;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // Function to parse the complex JSON + Markdown output and render it cleanly
Â  Â  Â  Â  function renderNotes(rawNotes) {
Â  Â  Â  Â  Â  Â  // Using a temporary variable for consistency checks
Â  Â  Â  Â  Â  Â  const tempOutputBox = outputBox;

Â  Â  Â  Â  Â  Â  // Check if outputBox is available before attempting to set innerHTML
Â  Â  Â  Â  Â  Â  if (!tempOutputBox) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("FATAL ERROR: outputBox element is missing or undefined.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  tempOutputBox.innerHTML = '';

Â  Â  Â  Â  Â  Â  // 1. Try to parse the notes
Â  Â  Â  Â  Â  Â  let notesData;
Â  Â  Â  Â  Â  Â  let glossaryData;
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Handle API response which might be an object directly, not a string needing parsing
Â  Â  Â  Â  Â  Â  Â  Â  if (typeof rawNotes === 'string') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Separate JSON and Markdown/Glossary parts if the string contains the separator
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const parts = rawNotes.split('\n\n---\n\n');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  notesData = JSON.parse(parts[0]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // If the second part is a JSON array (the separate glossary), parse it
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (parts.length > 1 && parts[1].trim().startsWith('[')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  glossaryData = JSON.parse(parts[1]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else if (typeof rawNotes === 'object' && rawNotes !== null) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Direct object received (common in successful AJAX flow)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  notesData = rawNotes;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error("Invalid notes data format.");
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // Final check: If glossary was embedded in notesData.key_terms, prioritize it.
Â  Â  Â  Â  Â  Â  Â  Â  

Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  tempOutputBox.innerHTML = `<h3 class="text-red-600 font-bold">Error Parsing Output:</h3><pre class="whitespace-pre-wrap p-2 bg-gray-100 rounded">${rawNotes}</pre><p class="mt-2 text-sm text-red-500">Details: ${e.message}</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Final validation check
Â  Â  Â  Â  Â  Â  if (!notesData || typeof notesData !== 'object') {
Â  Â  Â  Â  Â  Â  Â  Â  tempOutputBox.innerHTML = `<h3 class="text-red-600 font-bold">Error:</h3><p>Structured notes data is missing or invalid after parsing.</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 2. Render Structured Notes
Â  Â  Â  Â  Â  Â  let html = `<div class="p-4 space-y-4">`;

Â  Â  Â  Â  Â  Â  // Title
Â  Â  Â  Â  Â  Â  html += `<h2 class="text-3xl font-bold text-blue-700 border-b pb-2">${notesData.title || 'Untitled Notes'}</h2>`;

Â  Â  Â  Â  Â  Â  // Summary
Â  Â  Â  Â  Â  Â  html += `<div><h3 class="text-xl font-semibold text-gray-700">Executive Summary:</h3><p class="mt-1 p-3 bg-blue-50 rounded-lg">${notesData.summary}</p></div>`;

Â  Â  Â  Â  Â  Â  // --- RENDER KEY POINTS (with Syntax Highlighting) ---
Â  Â  Â  Â  Â  Â  if (notesData.key_points && Array.isArray(notesData.key_points) && notesData.key_points.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  html += `<div><h3 class="text-xl font-semibold text-gray-700 mt-4">Key Study Points:</h3>`;
Â  Â  Â  Â  Â  Â  Â  Â  html += `<ol class="list-decimal ml-6 mt-2 space-y-2">`;
Â  Â  Â  Â  Â  Â  Â  Â  notesData.key_points.forEach(point => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Regex to highlight mathematical terms for study
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const highlightedPoint = point.replace(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  /(\((?:\d+\/\d+)\)e\^-\(x\/\d+\)|e\^[-]?\d[\w/.]+|P\(X \W \d+\)|\âˆ«\[.*?\]|1 - e\^[-]?\d[\w/.]+|p\.d\.f\.|C\s?D\s?F)/g, 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '<code class="bg-yellow-100 text-red-600 font-mono text-sm p-1 rounded-sm">$1</code>'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `<li class="text-gray-800">${highlightedPoint}</li>`;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  html += `</ol></div>`;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // --- RENDER GLOSSARY (Rich Explanation Objects) ---
Â  Â  Â  Â  Â  Â  if (glossaryData && Array.isArray(glossaryData) && glossaryData.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  html += `<div><h3 class="text-xl font-bold text-blue-800 mt-6 border-b pb-1">ðŸ’¡ Key Term Explanations:</h3>`;
                //console.log(glossaryData);
Â  Â  Â  Â  Â  Â  Â  Â  glossaryData.forEach(termObj => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (termObj.term && termObj.explanation) {
                        const cleanExplanation = termObj.explanation.trim();
                        const cleanExample = termObj.example_or_analogy ? termObj.example_or_analogy.trim() : '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `
                    <div class="mt-3 p-3 bg-white rounded-lg border border-gray-200 shadow-sm">
                        <h4 class="text-lg font-semibold text-gray-900">${termObj.term}</h4>

                        <p class="mt-1 text-gray-700">
                            <span class="font-medium">Explanation:</span> ${cleanExplanation}
                        </p>

                        ${cleanExample ? 
                            `<p class="mt-1 text-sm text-gray-500 italic">
                                <span class="font-medium">Example:</span> ${cleanExample}
                            </p>` 
                            : ''}
                    </div>
                `;
            }
        });

        html += `</div>`;
    }

    html += `</div>`;
Â  Â  Â  Â  Â  Â  tempOutputBox.innerHTML = html;
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Polling Logic ---

Â  Â  Â  Â  async function pollJobStatus(jobId, interval = 3000) {
Â  Â  Â  Â  Â  Â  const statusUrl = `${API_BASE_URL}/job/${jobId}`;
Â  Â  Â  Â  Â  Â  let jobDone = false;

Â  Â  Â  Â  Â  Â  while (!jobDone) {
Â  Â  Â  Â  Â  Â  Â  Â  updateStatus(`Processing job... Waiting for notes. (Checking again in ${interval / 1000}s)`, 'loading');
Â  Â  Â  Â  Â  Â  Â  Â  //updateStatus(`Processing job ${jobId}... Waiting for notes. (Checking again in ${interval / 1000}s)`, 'loading');
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(statusUrl);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const result = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (result.status === "done") {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  jobDone = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleLoading(false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //updateStatus(`âœ… Job ${jobId} Complete!`, 'success');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateStatus(`âœ… Job Complete!`, 'success');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderNotes(result.notes);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (result.status === "error") {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  jobDone = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleLoading(false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateStatus(`âŒ Job failed! See output for details.`, 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //updateStatus(`âŒ Job ${jobId} failed! See output for details.`, 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderNotes(result.notes); // Display the error notes JSON
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleLoading(false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateStatus(`Polling Error: ${error.message}`, 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //updateStatus(`Polling Error for ${jobId}: ${error.message}`, 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  outputBox.textContent = error.message;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return; 
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // Wait for the specified interval before checking again
Â  Â  Â  Â  Â  Â  Â  Â  await new Promise(resolve => setTimeout(resolve, interval));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }


Â  Â  Â  Â  // --- Event Handlers ---

Â  Â  Â  Â  // Toggle Switch Logic
Â  Â  Â  Â  toggleSwitch.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  isImageMode = !isImageMode;
Â  Â  Â  Â  Â  Â  toggleSwitch.classList.toggle('checked', isImageMode);
Â  Â  Â  Â  Â  Â  textInputContainer.classList.toggle('hidden', isImageMode);
Â  Â  Â  Â  Â  Â  fileContainer.classList.toggle('hidden', !isImageMode);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Clear file input when switching away from image mode
Â  Â  Â  Â  Â  Â  if (!isImageMode) {
Â  Â  Â  Â  Â  Â  Â  Â  fileInput.value = '';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });


Â  Â  Â  Â  // Unified Form Submission Handler
Â  Â  Â  Â  mainForm.addEventListener('submit', async function(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  const userId = userIdInput.value;
Â  Â  Â  Â  Â  Â  const text = mainInput.value;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (!userId) {
Â  Â  Â  Â  Â  Â  Â  Â  updateStatus("Please enter a User ID.", 'error');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  toggleLoading(true);
Â  Â  Â  Â  Â  Â  outputBox.innerHTML = `<p class="text-gray-500 italic">Waiting for response...</p>`;

Â  Â  Â  Â  Â  Â  if (isImageMode) {
Â  Â  Â  Â  Â  Â  Â  Â  // --- Image Upload Flow (/upload) ---
Â  Â  Â  Â  Â  Â  Â  Â  const file = fileInput.files[0];

Â  Â  Â  Â  Â  Â  Â  Â  if (!file) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateStatus("Please select an image file.", 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleLoading(false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  updateStatus("Image agent called, waiting for response", 'loading');

Â  Â  Â  Â  Â  Â  Â  Â  const formData = new FormData();
Â  Â  Â  Â  Â  Â  Â  Â  formData.append('file', file);
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  const url = `${API_BASE_URL}/upload?user_id=${userId}`;

Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Step 1: Upload the file and get the job_id
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const uploadResponse = await fetch(url, { method: 'POST', body: formData });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const uploadResult = await uploadResponse.json();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (uploadResponse.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const jobId = uploadResult.job_id;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await pollJobStatus(jobId); // Start polling
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateStatus(`Upload Failed: ${uploadResponse.status} ${uploadResponse.statusText}`, 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  outputBox.textContent = JSON.stringify(uploadResult, null, 2);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleLoading(false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateStatus(`Network Error: ${error.message}`, 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  outputBox.textContent = error.message;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleLoading(false);
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // --- Text Query Flow (/query) ---
Â  Â  Â  Â  Â  Â  Â  Â  if (text.trim() === "") {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateStatus("Please enter text or a topic to generate notes.", 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleLoading(false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const payload = { user_id: userId, text: text, session_id: null };

Â  Â  Â  Â  Â  Â  Â  Â  updateStatus("Text agent called, waiting for notes...", 'loading');

Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(`${API_BASE_URL}/query`, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(payload)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const result = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateStatus(`Notes Generated successfully!`, 'success');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderNotes(result.notes);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateStatus(`Query Failed: ${response.status} ${response.statusText}`, 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  outputBox.textContent = JSON.stringify(result, null, 2);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateStatus(`Network Error: ${error.message}`, 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  outputBox.textContent = error.message;
Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  toggleLoading(false);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>